@model IEnumerable<JobsForJoe.Data.EF.OpenPosition>
@using Microsoft.AspNet.Identity




@{
    ViewBag.Title = "Open Positions";
}

<h2>@ViewBag.Title</h2>

@if (User.IsInRole("Admin"))
{
    <p>
        @Html.ActionLink("Create New", "Create")
    </p>
}

<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.Position.Title)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Location.StoreName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Location.City)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Location.State)
        </th>
        <th></th>
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.Position.Title)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.Location.StoreName)
        </td>
        <th>
            @Html.DisplayFor(modelItem => item.Location.City)
        </th>
        <th>
            @Html.DisplayFor(modelItem => item.Location.State)
        </th>
        <td>
            @if (User.Identity.IsAuthenticated)
            {
                if (ViewBag.AppliedOP != null )
                {
                    if (ViewBag.AppliedOP.Contains(item.OpenPositionID))
                    {
                        <i class="material-icons">done_outline</i>
                    }
                    else
                    {
                        <button class="btn btn-info">
                            @Html.ActionLink("Apply", "Apply", new { id = item.OpenPositionID })
                        </button>
                    }
                }
            }
            else
            {
                @Html.ActionLink("Upload Resume", "Edit", "UserDetails", new { id = User.Identity.GetUserId() }, null)
            }


        </td>
        <td>
            @if (User.IsInRole("Admin"))
            {
                @Html.ActionLink("Edit", "Edit", new { id = item.OpenPositionID }) @:|
            }
            
            @Html.ActionLink("Details", "Details", new { id=item.OpenPositionID }) 
            @if (User.IsInRole("Admin"))
            {
               @:| @Html.ActionLink("Delete", "Delete", new { id = item.OpenPositionID })
            }
            
        </td>
    </tr>
}

</table>
